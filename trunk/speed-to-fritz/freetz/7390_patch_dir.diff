diff -Nur patches/7390/100-rc.net-dnsmasq.patch 16MB-freetz-patches/7390/100-rc.net-dnsmasq.patch
--- patches/7390/100-rc.net-dnsmasq.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/100-rc.net-dnsmasq.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,14 @@
+--- etc/init.d/rc.net.orig	2010-01-22 19:11:40.000000000 +0100
++++ etc/init.d/rc.net	2010-01-22 19:11:40.000000000 +0100
+@@ -12,6 +12,11 @@
+ 
+ PATH=/bin:/usr/bin:/sbin:/usr/sbin
+ 
++# allow wrapper
++PKG=dnsmasq
++BASE=/mod/pkg/$PKG
++PATH=$BASE/usr/lib/$PKG/bin:$PATH
++
+ case "`uname -r`" in
+   2.6* ) KERNEL_26=yes; ;;
+   *    ) KERNEL_26=no; ;;
diff -Nur patches/7390/110-rc.S-mknod.patch 16MB-freetz-patches/7390/110-rc.S-mknod.patch
--- patches/7390/110-rc.S-mknod.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/110-rc.S-mknod.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,14 @@
+--- etc/init.d/rc.S.orig	2009-09-17 09:18:48.078288387 +0200
++++ etc/init.d/rc.S	2009-09-17 09:18:48.222750066 +0200
+@@ -217,6 +217,11 @@
+ #########################################################################
+ mknod /var/flash/voip.cfg c $tffs_major $((0x72))
+ mknod /var/flash/voipd_call_stat c $tffs_major $((0x7A))
++#########################################################################
++## freetz
++#########################################################################
++mknod /var/flash/freetz c $tffs_major $((0x3c))
++/usr/bin/modload 2>&1 | tee /var/log/mod_load.log
+ ## mknod /var/flash/telefon_msns c $tffs_major $((0x80)) entfaellt mit tecfg v54
+ #########################################################################
+ ## FLASH_FS_ID_MSNLISTE = 0x0080, /*--- /var/flash/telefon_msns ---*/
diff -Nur patches/7390/120-rc.S-dev.patch 16MB-freetz-patches/7390/120-rc.S-dev.patch
--- patches/7390/120-rc.S-dev.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/120-rc.S-dev.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,14 @@
+--- etc/init.d/rc.S.orig	2008-02-22 20:05:11.000000000 +0100
++++ etc/init.d/rc.S	2008-02-22 20:05:11.000000000 +0100
+@@ -96,8 +96,9 @@
+ ##########################################################################################
+ ## rc.S for 2.6 Kernel
+ ##########################################################################################
+-mount -n /proc
+-mount /var
++[ -f /dev/.hotplug-cache ] || mount -o nosuid -t tmpfs dev /dev
++/sbin/makedevs -d /etc/device.table /
++mount -a
+ ##########################################################################################
+ ##########################################################################################
+ echo init-start 240 >/dev/watchdog
diff -Nur patches/7390/130-rc.S-logging.patch 16MB-freetz-patches/7390/130-rc.S-logging.patch
--- patches/7390/130-rc.S-logging.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/130-rc.S-logging.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,23 @@
+--- etc/init.d/rc.S.orig	2008-02-22 20:05:11.000000000 +0100
++++ etc/init.d/rc.S	2008-02-22 20:05:11.000000000 +0100
+@@ -102,6 +102,20 @@
+ ##########################################################################################
+ ##########################################################################################
+ echo init-start 240 >/dev/watchdog
++
++# Load boot loader kernel_args API
++. /usr/bin/kernel_args
++# Backup kernel log ring buffer ASAP, so as not to lose its earliest entries
++if ka_isActiveVariable SaveKernelRingBuffer; then
++	ka_decreaseValue SaveKernelRingBuffer
++	dmesg > /var/dmesg-rc.S.log
++fi
++# Initiate inotify-tools file access logging
++if ka_isActiveVariable InotifyBootAnalysis; then
++	ka_decreaseValue InotifyBootAnalysis
++	/etc/init.d/rc.inotify_tools start 
++fi
++
+ ##########################################################################################
+ ## aus den kernel parameters die für die module ermitteln
+ ##########################################################################################
diff -Nur patches/7390/140-rc.S-no_avm_exit.patch 16MB-freetz-patches/7390/140-rc.S-no_avm_exit.patch
--- patches/7390/140-rc.S-no_avm_exit.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/140-rc.S-no_avm_exit.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,7 @@
+--- etc/init.d/rc.S.orig	2010-03-02 10:44:57.933246576 +0100
++++ etc/init.d/rc.S	2010-03-02 10:44:57.983239731 +0100
+@@ -1572,4 +1572,3 @@
+ echo "$0[$$]: trigger: msgsend ctlmgr check-plugins"
+ msgsend ctlmgr check-plugins
+ #########################################################################
+-exit 0
diff -Nur patches/7390/200-modules_symlink.sh 16MB-freetz-patches/7390/200-modules_symlink.sh
--- patches/7390/200-modules_symlink.sh	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/200-modules_symlink.sh	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,2 @@
+echo1 "making symlink for modules (-ur8)"
+ln -s 2.6.19.2 ${FILESYSTEM_MOD_DIR}/lib/modules/2.6.19.2-ur8
diff -Nur patches/7390/de/130-foncalls.patch 16MB-freetz-patches/7390/de/130-foncalls.patch
--- patches/7390/de/130-foncalls.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/130-foncalls.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,28 @@
+--- usr/www/all/html/de/home/foncalls.js.orig	2010-01-21 15:40:39.000000000 +0100
++++ usr/www/all/html/de/home/foncalls.js	2010-01-22 19:11:41.000000000 +0100
+@@ -358,17 +358,17 @@ var buchentryinfo = GetBuchEntryInfo(buc
+ var tooltip=nr;
+ if (nr!="")
+ tooltip=buchentryinfo+" = "+nr;
+-if (nr=="" && buchname=="") return g_txtUnbekannt;
++if (nr=="" && buchname=="") return g_sym0 + g_txtUnbekannt;
+ if ("<? query telcfg:settings/UseClickToDial ?>" == "1") {
+-if (nr == "") return span(buchentryinfo);
+-if (buchname == "") {
+-return "<nobr>" +
+-"<a href=\"javascript:Dial('"+nr+"')\" title=\""+nr+"\">"+nr+"</a></nobr>";
+-}
+-return "<nobr><a href=\"javascript:Dial('"+nr+"')\" title=\""+tooltip+"\">"+buchentryinfo+"</a></nobr>";
++if (nr == "") return g_sym0 + span(buchentryinfo);
++if (buchname == "") return "<nobr>" + uiRufnummerInfo (nr) +"<a href=\"javascript:Dial('"+nr+"')\" title=\""+nr+"\">"+nr+"</a></nobr>";
++return "<nobr>" +  g_sym0 + "<a href=\"javascript:Dial('"+nr+"')\" title=\""+buchentryinfo+"\">"+buchentryinfo+"</a></nobr>";
+ } else {
+-return spanEx(tooltip,buchname=="" ? nr:buchentryinfo);
++return (buchname=="" ? uiRufnummerInfo(nr):g_sym0) + span(buchname=="" ? nr:buchentryinfo);
++}
+ }
++function uiRufnummerInfo (nr) {
++return "<a href=\"http://www.dasoertliche.de/Controller?form_name=search_inv&ph=" + encodeURI (nr) + "\" target=\"_blank\" title=\"R&uuml;ckw&auml;rtssuche bei dasoertliche.de nach "+nr+"\"><img src=\"../html/<? echo $var:lang ?>/images/bearbeiten.gif\"></a>";
+ }
+ function uiRouteDisplay (n, t) {
+ var name;
diff -Nur patches/7390/de/190-webmenu.patch 16MB-freetz-patches/7390/de/190-webmenu.patch
--- patches/7390/de/190-webmenu.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/190-webmenu.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,18 @@
+--- usr/www/all/html/de/menus/menu2_homehome.html.orig	2010-03-01 13:11:18.000000000 +0100
++++ usr/www/all/html/de/menus/menu2_homehome.html	2010-03-02 10:44:58.033237452 +0100
+@@ -58,5 +58,6 @@
+ <? if eq $var:pagename energy `<? setvariable var:classname 'LStatusMenuitemaktivTop' ?>` ?>
+ <? if eq $var:pagename ecosettings `<? setvariable var:classname 'LStatusMenuitemaktivTop' ?>` ?>
+ <li class="<? echo $var:classname ?>"><img class="LMenuPfeil" src="<? echo $var:aktivpfeil ?>"><a href="javascript:jslGoTo('home','energy')">{?de.menus.menu2_homehome.html:105EnergyMonitor?}</a><span class="PTextOnly">{?de.menus.menu2_homehome.html:110EnergyMonitor?}</span></li>
++<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz</a><span class="PTextOnly">Freetz</span></li>
+ <li class="LMenubottom">&nbsp;</li>
+ </ul>
+--- usr/www/all/html/de/menus/menu2_konfig.html.orig	2010-03-01 13:11:13.000000000 +0100
++++ usr/www/all/html/de/menus/menu2_konfig.html	2010-03-02 10:44:58.033237452 +0100
+@@ -79,5 +79,6 @@
+ <li class="LMenuitemaktivTop"><img class="LMenuPfeil" src="../html/de/images/leer.gif" style="width:7px;"><a href="javascript:jslGoTo('software','extern')">{?txtPrograms?}</a><span class="PTextOnly">{?txtPrograms?}</span></li>
+ ` ?>
+ ` ?>
++<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz</a><span class="PTextOnly">Freetz</span></li>
+ <li class="LMenubottom">&nbsp;</li>
+ </ul>
diff -Nur patches/7390/de/200-sperre1.patch 16MB-freetz-patches/7390/de/200-sperre1.patch
--- patches/7390/de/200-sperre1.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/200-sperre1.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,20 @@
+--- usr/www/avm/html/de/fon/sperre1.js.orig	2009-02-25 10:41:49.000000000 +0100
++++ usr/www/avm/html/de/fon/sperre1.js	2009-02-27 09:02:47.000000000 +0100
+@@ -68,7 +68,7 @@
+ var nummer="";
+ if (jslGetValue("uiViewBereichIncoming") == "")
+ nummer = jslGetValue("uiViewNummer");
+-if (!isZahlRaute(nummer)) {alert(g_mldNonDigits); return;}
++//if (!isZahlRaute(nummer)) {alert(g_mldNonDigits); return;}
+ var x = IstActionVorhanden(nummer);
+ if (x != "") {
+ if (jslGetValue("uiPostInAction"+x) == "1") {
+@@ -161,7 +161,7 @@
+ }
+ } else {
+ var nummer = jslGetValue("uiViewNummer");
+-if (!isZahlRaute(nummer)) {alert(g_mldNonDigits); return;}
++//if (!isZahlRaute(nummer)) {alert(g_mldNonDigits); return;}
+ var x = IstActionVorhanden(nummer);
+ if (x != "") {
+ if (jslGetValue("uiPostInAction"+x) == "1") {alert(g_txtAlert_1); return;}
diff -Nur patches/7390/de/210-notmountable.patch 16MB-freetz-patches/7390/de/210-notmountable.patch
--- patches/7390/de/210-notmountable.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/210-notmountable.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,22 @@
+--- usr/www/all/html/de/home/home.js.orig	2009-11-25 14:27:00.000000000 +0100
++++ usr/www/all/html/de/home/home.js	2009-11-27 11:33:24.490470753 +0100
+@@ -768,7 +768,7 @@ if (isNaN(nStor)) nStor = 0;
+ var nPartTotal = Number(g_usbhost_data.part_count_total);
+ if (isNaN(nPartTotal)) nPartTotal = 0;
+ var unplugOk = parseInt(g_usbhost_data.unplug_ok, 10) == 1;
+-if (nPartTotal > nStor)
++if (nPartTotal > 0)
+ {
+ if (unplugOk)
+ {
+@@ -776,9 +776,7 @@ strStor = "{?de.home.home.js:912?}";
+ }
+ else
+ {
+-strStor = "{?de.home.home.js:5308?} ";
+-strStor += "<a href=\"javascript:syslog_jslSubmitFormEx(5);\">{?de.home.home.js:3744?}</a>";
+-strStor = strStor.fontcolor("#cc0000");
++strStor = "Es wurden " + nStor + " von " + nPartTotal + " Partitionen eingebunden.";
+ }
+ strArr.push(strStor);
+ }
diff -Nur patches/7390/de/290-replace_websrv-remove_igdd.patch 16MB-freetz-patches/7390/de/290-replace_websrv-remove_igdd.patch
--- patches/7390/de/290-replace_websrv-remove_igdd.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/290-replace_websrv-remove_igdd.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,40 @@
+--- etc/init.d/rc.net.orig	2010-03-02 10:44:57.883237773 +0100
++++ etc/init.d/rc.net	2010-03-02 10:44:58.133236744 +0100
+@@ -59,9 +59,25 @@
+    WLAN_TEST=0
+ fi
+ 
++# Do we have a UPnP server (upnpd) or was ist stripped from the firmware?
++_upnpd=$(basename $(which upnpd) 2> /dev/null)
++# Does a multid option to start without UPnP device (-U) exist?
++_multid_upnp=$(/sbin/multid -? 2>&1 | grep upnp)
++# Does a dsld option to start without igd (-g) exist?
++_dsld_upnp=$(/sbin/dsld -? 2>&1 | grep igd)
++# Set multid "no UPnP" option, if
++#   a) it has the parameter at all AND
++#   b) upnpd binary does *not* exist
++[ "$_multid_upnp" ] && [ ! "$_upnpd" ] && MULTIDPARAM="$MULTIDPARAM -U -P"
++# Set dsld "no igd" option, if
++#   a) it has the parameter at all AND
++#   b) upnpd binary does *not* exist
++[ "$_dsld_upnp" ] && [ ! "$_upnpd" ] && DSLDDPARAM="-g"
++
+ 
+ upnpdstart()
+ {
++	 [ "$_upnpd" ] || return;
+    if [ "`pidof upnpd`" = "" ] ; then
+       upnpd $VERBOSEPARAM
+       sleep 1
+@@ -293,9 +309,9 @@
+    if [ "$CONFIG_DSL" ] ; then
+      if [ "`pidof dsld`" = "" ] ; then
+        if [ "$CONFIG_RAMSIZE" = 8 ] ; then
+-         dsld -i -n $NICEPARAM -r 600 $VERBOSEPARAM
++         dsld -i -n $NICEPARAM -r 600 $VERBOSEPARAM $DSLDDPARAM
+        else
+-         dsld -i -n $NICEPARAM $VERBOSEPARAM
++         dsld -i -n $NICEPARAM $VERBOSEPARAM $DSLDDPARAM
+        fi
+      fi
+    fi
diff -Nur patches/7390/de/301-remove_smbd.patch 16MB-freetz-patches/7390/de/301-remove_smbd.patch
--- patches/7390/de/301-remove_smbd.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/7390/de/301-remove_smbd.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,19 @@
+--- etc/init.d/rc.net.orig	2010-03-02 10:44:58.133236744 +0100
++++ etc/init.d/rc.net	2010-03-02 10:44:58.173237454 +0100
+@@ -73,6 +73,8 @@
+ #   a) it has the parameter at all AND
+ #   b) upnpd binary does *not* exist
+ [ "$_dsld_upnp" ] && [ ! "$_upnpd" ] && DSLDDPARAM="-g"
++# Do we have a Samba server (smbd) or was ist stripped from the firmware?
++_smbd=$(basename $(which smbd) 2> /dev/null)
+ 
+ 
+ upnpdstart()
+@@ -323,6 +325,7 @@
+ #we have the samba cfg in /var, so crate them there
+ sambastart()
+ {
++   [ "$_smbd" ] || return;
+    cd /
+    tar xf /var.tar
+    /bin/smbd
diff -Nur patches/cond/de/webmenu-wol-7390.patch 16MB-freetz-patches/cond/de/webmenu-wol-7390.patch
--- patches/cond/de/webmenu-wol-7390.patch	1970-01-01 01:00:00.000000000 +0100
+++ 16MB-freetz-patches/cond/de/webmenu-wol-7390.patch	2010-04-27 20:49:38.000000000 +0200
@@ -0,0 +1,22 @@
+--- usr/www/all/html/de/menus/menu2_homehome.html.orig	2010-03-02 10:44:58.033237452 +0100
++++ usr/www/all/html/de/menus/menu2_homehome.html	2010-03-02 10:44:58.873237622 +0100
+@@ -58,6 +58,7 @@
+ <? if eq $var:pagename energy `<? setvariable var:classname 'LStatusMenuitemaktivTop' ?>` ?>
+ <? if eq $var:pagename ecosettings `<? setvariable var:classname 'LStatusMenuitemaktivTop' ?>` ?>
+ <li class="<? echo $var:classname ?>"><img class="LMenuPfeil" src="<? echo $var:aktivpfeil ?>"><a href="javascript:jslGoTo('home','energy')">{?de.menus.menu2_homehome.html:105EnergyMonitor?}</a><span class="PTextOnly">{?de.menus.menu2_homehome.html:110EnergyMonitor?}</span></li>
+-<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz</a><span class="PTextOnly">Freetz</span></li>
++<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz Config</a><span class="PTextOnly">Freetz Config</span></li>
++<li class="LMenuitemTop"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_wol" target="_blank">Freetz WOL</a><span class="PTextOnly">Freetz WOL</span></li>
+ <li class="LMenubottom">&nbsp;</li>
+ </ul>
+--- usr/www/all/html/de/menus/menu2_konfig.html.orig	2010-03-02 10:44:58.033237452 +0100
++++ usr/www/all/html/de/menus/menu2_konfig.html	2010-03-02 10:44:58.873237622 +0100
+@@ -79,6 +79,7 @@
+ <li class="LMenuitemaktivTop"><img class="LMenuPfeil" src="../html/de/images/leer.gif" style="width:7px;"><a href="javascript:jslGoTo('software','extern')">{?txtPrograms?}</a><span class="PTextOnly">{?txtPrograms?}</span></li>
+ ` ?>
+ ` ?>
+-<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz</a><span class="PTextOnly">Freetz</span></li>
++<li class="LMenuitemTop" style="margin-top:24px"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_status" target="_blank">Freetz Config</a><span class="PTextOnly">Freetz Config</span></li>
++<li class="LMenuitemTop"><img src="<? echo $var:pfeil ?>"> <a href="/cgi-bin/freetz_wol" target="_blank">Freetz WOL</a><span class="PTextOnly">Freetz WOL</span></li>
+ <li class="LMenubottom">&nbsp;</li>
+ </ul>
BinÃ¤rdateien root/lib/libgcc_s_pic.a and 16MB-freetz-root/lib/libgcc_s_pic.a sind verschieden.
